<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../../resources/css/market/purchaseDetailsPage.css">
        <link rel="stylesheet" href="../../resources/css/reset.css">
        
        <title>구매 상세 페이지</title>
    </head>
    <body>
        <div id="container">
            <header>
    
            </header>
            <main>
                <div id="detailHeader">
                    <h2>[S급][직거래]KT/갤럭시s23Ultra/화이트/512GB/풀박스 판매합니다.</h2>
                </div>
                <div id = "detailMain">
                    <div id="mainLeft">
                        <div id="mainImg">
                            <img src="../../resources/images/product/subsaleimgs23u-1.png" alt="메인판매사진">
                        </div>
                        <div id="subImg">
                            <div class="sub"  onclick="changeMainImg(this)">
                                <img src="../../resources/images/product/subsaleimgs23u-1.png" alt="서브판매사진1">
                            </div>
                            <div class="sub" onclick="changeMainImg(this)">
                                <img src="../../resources/images/product/subsaleimgs23u-2.png" alt="서브판매사진2">
                            </div>
                            <div class="sub" onclick="changeMainImg(this)">
                                <img src="../../resources/images/product/subsaleimgs23u-3.png" alt="서브판매사진3">
                            </div>
                            <div class="sub" onclick="changeMainImg(this)">
                                <img src="../../resources/images/product/subsaleimgs23u-4.png" alt="서브판매사진4">
                            </div>
                            <div class="sub" onclick="changeMainImg(this)">
                                <img src="../../resources/images/product/subsaleimgs23u-5.png" alt="서브판매사진5">
                            </div>
                        </div>
                        <div id="details">
                            <h2>물품 설명</h2>
                            <div id="detailText"><p>선택약정 25%요금할인 불가(이미 선택약정 할인받고 계신 유심만 바꿔끼워서 사용하시면 그대로 적용가능합니다). 침수나 도난 분실 취급하지 않습니다. 액정 앞,뒷면과 모서리,테두리 모두 기스나 찍힘없이 깨끗한S급 입니다. 그외 잔상없고 전기능 이상없음. 구매하시면 C타입 충전기 새상품 같이 드립니다. 개통일은 23년 3월 22일 이며 25년 3월 말 일까지 무상AS기간 남아있습니다(배터리,잔상은1년). 로젠택배 이용중이며 오후 5시까지 당일발송 가능합니다(주말 및 공휴일 제외).</p></div>
                        </div>
                    </div>
                    <div id="mainRight">
                        <div id="rating">
                            <div>폰다판다 감정등급 <span>[S급]</span></div>
                        </div>
                        <div class="detailInfo">
                            <table class="infoBox">
                                <tr>
                                    <th>모델명</th>
                                    <td>갤럭시s23Ultra(512GB)</td>
                                </tr>
                                <tr>
                                    <th>통신사</th>
                                    <td>KT(나노유심)</td>
                                </tr>
                                <tr>
                                    <th>개통일</th>
                                    <td>2023-03-22</td>
                                </tr>
                            </table>
                        </div>
                        <div class="detailInfo">
                            <table class="infoBox">
                                <tr>
                                    <th>제품상태</th>
                                    <td>S급</td>
                                </tr>
                                <tr>
                                    <th>구성품</th>
                                    <td>풀박스</td>
                                </tr>
                                <tr>
                                    <th>기변상태</th>
                                    <td>미확인</td>
                                </tr>
                                <tr>
                                    <th>선택약정</th>
                                    <td>약정불가</td>
                                </tr>
                                <tr>
                                    <th>보증기간</th>
                                    <td>보증가능</td>
                                </tr>
                            </table>
                        </div>
                        <div id="sallingPrice">
                            <div class="detailBox">
                                <div>직거래</div>
                                <span>1,190,000원</span>
                            </div>
                        </div>
                        <div id="purchaseArea">
                            <div class="detailBox">
                                <button id="chatButton">채팅하기</button>
                                <button onclick="openPurchasePopup()">구매신청</button>
                            </div>
                        </div>
                        <div id="sellerInfo" class="detailInfo">
                            <table class="infoBox">
                                <tr>
                                    <th>판매점수</th>
                                    <td>5점</td>
                                </tr>
                                <tr>
                                    <th>아이디</th>
                                    <td>kkk***</td>
                                </tr>
                                <tr>
                                    <th>안전거래완료</th>
                                    <td>15건</td>
                                </tr>
                                <tr>
                                    <th>판매자의 다른 물품</th>
                                    <td>0건</td>
                                </tr>
                            </table>
                        </div>

                    </div>
                </div>
        </div>
            </main>
            <footer>
    
            </footer>
        </div>
        
        <script>
            function loadHTML(url, element) {
                const xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState === 4 && this.status === 200) {
                        const content = this.responseText;
                        element.innerHTML = content;

                        const scriptTags = element.getElementsByTagName("script");
                        for (var i = 0; i < scriptTags.length; i++) {
                            eval(scriptTags[i].innerText);
                        }
                    }
                };
                xhttp.open("GET", url, true);
                xhttp.send();
            }

            document.addEventListener("DOMContentLoaded", function() {
                const headerElement = document.querySelector("header");
                loadHTML("../components/header.html", headerElement);

                const footerElement = document.querySelector("footer");
                loadHTML("../components/footer.html", footerElement);
            });

            function changeMainImg(element) {
                const mainImg = document.querySelector("#mainImg img");
                const clickedImg = element.querySelector("img");

                mainImg.src = clickedImg.src;
            }

            // 자동 이미지 전환
            let currentIndex = 0;
            const subImages = document.querySelectorAll(".sub");

            function autoChangeMainImg() {
                currentIndex = (currentIndex + 1) % subImages.length;
                const nextImg = subImages[currentIndex].querySelector("img");
                const mainImg = document.querySelector("#mainImg img");
                mainImg.src = nextImg.src;
            }

            setInterval(autoChangeMainImg, 3000);

            // "채팅하기" 버튼 클릭 이벤트 핸들러
            document.getElementById("chatButton").addEventListener("click", function() {
                // 팝업 창을 열기 위해 채팅 페이지 URL 설정
                var chatPageUrl = "./purchaseChat2.html";

                // 팝업 창 설정
                var popupWidth = 500;
                var popupHeight = 500;
                var popupLeft = (window.innerWidth - popupWidth) / 2;
                var popupTop = (window.innerHeight - popupHeight) / 2;
                var popupOptions = 'width=' + popupWidth + ',height=' + popupHeight + ',left=' + popupLeft + ',top=' + popupTop;
                
                // 팝업 창 열기
                window.open(chatPageUrl, 'Chat', popupOptions);
            });

            function openPurchasePopup(){      
                alert("원활한 거래를 위하여 구매전에 판매자와 먼저 채팅을 진행 한 후, 예약하기 버튼을 눌러주세요")
                var chatPageUrl = "./purchaseChat2.html";          
                var popupWidth = 500;
                var popupHeight = 500;
                var popupLeft = (window.innerWidth - popupWidth) / 2;
                var popupTop = (window.innerHeight - popupHeight) / 2;
                var popupOptions = 'width=' + popupWidth + ',height=' + popupHeight + ',left=' + popupLeft + ',top=' + popupTop;
            
                window.open(chatPageUrl, 'Chat', popupOptions);
            }
        </script>
    </body>
    
</html>