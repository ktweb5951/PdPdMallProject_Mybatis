<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../../resources/css/market/purchaseDetailsPage.css">
        <link rel="stylesheet" href="../../resources/css/reset.css">
        
        <title>구매 상세 페이지</title>
    </head>
    <body>
        <div id="container">
            <header>
    
            </header>
            <main>
                <div id="detailHeader">
                    <h2>[S급][직거래]Lg/아이폰14/화이트/256GB/풀박스 판매합니다.</h2>
                </div>
                <div id = "detailMain">
                    <div id="mainLeft">
                        <div id="mainImg">
                            <img src="../resources/images/product/subsaleimg1.png" alt="메인판매사진">
                        </div>
                        <div id="subImg">
                            <div class="sub"  onclick="changeMainImg(this)">
                                <img src="../resources/images/product/subsaleimg1.png" alt="서브판매사진1">
                            </div>
                            <div class="sub" onclick="changeMainImg(this)">
                                <img src="../resources/images/product/subsaleimg2.png" alt="서브판매사진2">
                            </div>
                            <div class="sub" onclick="changeMainImg(this)">
                                <img src="../resources/images/product/subsaleimg3.png" alt="서브판매사진3">
                            </div>
                            <div class="sub" onclick="changeMainImg(this)">
                                <img src="../resources/images/product/subsaleimg4.png" alt="서브판매사진4">
                            </div>
                            <div class="sub" onclick="changeMainImg(this)">
                                <img src="../resources/images/product/subsaleimg5.png" alt="서브판매사진5">
                            </div>
                        </div>
                        <div id="details">
                            <h2>물품 설명</h2>
                            <div id="detailText"><p>상태 완전좋은 아이폰14 화이트 256gb 싸게팝니다. <br> 구성품 다드려요<br><br> 직거래는 종각역에서만 거래 가능합니다.<br>에누리 안받아요.</p></div>
                        </div>
                    </div>
                    <div id="mainRight">
                        <div id="rating">
                            <div>폰다판다 감정등급 <span>[S급]</span></div>
                        </div>
                        <div class="detailInfo">
                            <table class="infoBox">
                                <tr>
                                    <th>모델명</th>
                                    <td>아이폰14(256GB)</td>
                                </tr>
                                <tr>
                                    <th>통신사</th>
                                    <td>LG U+(나노유심)</td>
                                </tr>
                                <tr>
                                    <th>개통일</th>
                                    <td>2023-05-10</td>
                                </tr>
                            </table>
                        </div>
                        <div class="detailInfo">
                            <table class="infoBox">
                                <tr>
                                    <th>제품상태</th>
                                    <td>S급</td>
                                </tr>
                                <tr>
                                    <th>구성품</th>
                                    <td>풀박스</td>
                                </tr>
                                <tr>
                                    <th>기변상태</th>
                                    <td>미확인</td>
                                </tr>
                                <tr>
                                    <th>선택약정</th>
                                    <td>약정불가</td>
                                </tr>
                                <tr>
                                    <th>보증기간</th>
                                    <td>보증가능</td>
                                </tr>
                            </table>
                        </div>
                        <div id="sallingPrice">
                            <div class="detailBox">
                                <div>직거래</div>
                                <span>930,000원</span>
                            </div>
                        </div>
                        <div id="purchaseArea">
                            <div class="detailBox">
                                <button id="chatButton">채팅하기</button>
                                <button onclick="openPurchasePopup()">구매신청</button>
                            </div>
                        </div>
                        <div id="sellerInfo" class="detailInfo">
                            <table class="infoBox">
                                <tr>
                                    <th>판매점수</th>
                                    <td>4.5점</td>
                                </tr>
                                <tr>
                                    <th>아이디</th>
                                    <td>dwdw***</td>
                                </tr>
                                <tr>
                                    <th>안전거래완료</th>
                                    <td>5건</td>
                                </tr>
                                <tr>
                                    <th>판매자의 다른 물품</th>
                                    <td>2건</td>
                                </tr>
                            </table>
                        </div>

                    </div>
                </div>
        </div>
            </main>
            <footer>
    
            </footer>
        </div>
        
        <script>
            function loadHTML(url, element) {
                const xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState === 4 && this.status === 200) {
                        const content = this.responseText;
                        element.innerHTML = content;

                        const scriptTags = element.getElementsByTagName("script");
                        for (var i = 0; i < scriptTags.length; i++) {
                            eval(scriptTags[i].innerText);
                        }
                    }
                };
                xhttp.open("GET", url, true);
                xhttp.send();
            }

            document.addEventListener("DOMContentLoaded", function() {
                const headerElement = document.querySelector("header");
                loadHTML("../components/header.jsp", headerElement);

                const footerElement = document.querySelector("footer");
                loadHTML("../components/footer.jsp", footerElement);
            });

            function changeMainImg(element) {
                const mainImg = document.querySelector("#mainImg img");
                const clickedImg = element.querySelector("img");

                mainImg.src = clickedImg.src;
            }

            // 자동 이미지 전환
            let currentIndex = 0;
            const subImages = document.querySelectorAll(".sub");

            function autoChangeMainImg() {
                currentIndex = (currentIndex + 1) % subImages.length;
                const nextImg = subImages[currentIndex].querySelector("img");
                const mainImg = document.querySelector("#mainImg img");
                mainImg.src = nextImg.src;
            }

            setInterval(autoChangeMainImg, 3000);

            // "채팅하기" 버튼 클릭 이벤트 핸들러
            document.getElementById("chatButton").addEventListener("click", function() {
                // 팝업 창을 열기 위해 채팅 페이지 URL 설정
                var chatPageUrl = "./purchaseChat.html";

                // 팝업 창 설정
                var popupWidth = 500;
                var popupHeight = 500;
                var popupLeft = (window.innerWidth - popupWidth) / 2;
                var popupTop = (window.innerHeight - popupHeight) / 2;
                var popupOptions = 'width=' + popupWidth + ',height=' + popupHeight + ',left=' + popupLeft + ',top=' + popupTop;
                
                // 팝업 창 열기
                window.open(chatPageUrl, 'Chat', popupOptions);
            });

            function openPurchasePopup(){      
                alert("원활한 거래를 위하여 구매전에 판매자와 먼저 채팅을 진행 한 후, 예약하기 버튼을 눌러주세요")
                var chatPageUrl = "./purchaseChat.html";          
                var popupWidth = 500;
                var popupHeight = 500;
                var popupLeft = (window.innerWidth - popupWidth) / 2;
                var popupTop = (window.innerHeight - popupHeight) / 2;
                var popupOptions = 'width=' + popupWidth + ',height=' + popupHeight + ',left=' + popupLeft + ',top=' + popupTop;
            
                window.open(chatPageUrl, 'Chat', popupOptions);
            }
        </script>
    </body>
    
</html>